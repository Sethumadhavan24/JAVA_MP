<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>SkillLink - Find Your Trainer</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

    <link rel="stylesheet" th:href="@{/css/global.css}">
    <link rel="stylesheet" th:href="@{/css/search.css}">
</head>
<body>
<div class="container">
    <div class="header">
        <h1>Find Your Trainer (Alex's View)</h1>
        <p><a th:href="@{/}">← Back to Home</a></p>
    </div>

    <div class="search-form">
        <input type="text" id="skillInput" placeholder="Skill (e.g., Yoga, Piano)" required>
        <input type="text" id="locationInput" placeholder="Location (e.g., Chennai, Bengaluru)">
        <button id="searchButton">Search</button>
    </div>

    <h2>Search Results</h2>
    <div id="resultsList">
        <p>Enter your search criteria above to find available trainers.</p>
    </div>
</div>

<script>
    $(document).ready(function() {
        // Function to handle the search button click
        $('#searchButton').click(function() {
            const skill = $('#skillInput').val();
            const location = $('#locationInput').val();

            if (!skill) {
                alert("Please enter a skill.");
                return;
            }

            $('#resultsList').html('<p>Searching...</p>');

            // Build the API URL with query parameters
            let apiUrl = `/api/search/trainers?skill=${skill}`;
            if (location) {
                apiUrl += `&location=${location}`;
            }

            // Perform the AJAX GET Request (Calls your proven backend API)
            $.ajax({
                url: apiUrl,
                method: 'GET',
                success: function(data) {
                    renderResults(data);
                },
                error: function(jqXHR, textStatus, errorThrown) {
                    console.error("Search API Error:", textStatus, errorThrown, jqXHR.responseText);
                    $('#resultsList').html('<p style="color: red;">Error searching trainers. Please check if the backend server is running.</p>');
                }
            });
        });

        // Function to render the trainer cards from JSON data
        function renderResults(trainers) {
            const list = $('#resultsList');
            list.empty(); // Clear previous results

            if (trainers.length === 0) {
                list.html('<p>No trainers match your search criteria.</p>');
                return;
            }

            trainers.forEach(trainer => {
                const verificationBadge = trainer.isCertificationVerified
                    ? '<span class="verified">✓ Certified Trainer</span>'
                    : '<span>(Not Verified)</span>';

                // Path to the new booking view, passing the trainer ID
                const profileLink = `/booking/trainer/${trainer.id}`;

                const card = `
                    <div class="trainer-card">
                        <div class="trainer-info">
                            <h3>${trainer.firstName} ${trainer.lastName} (${trainer.mainSkill})</h3>
                            <p><strong>Rate:</strong> ₹${trainer.hourlyRate.toFixed(2)}/hour</p>
                            <p><strong>Location:</strong> ${trainer.location || 'Remote/Negotiable'}</p>
                            <p>${verificationBadge}</p>
                        </div>
                        <div>
                            <a href="${profileLink}" class="book-button">View Availability & Book</a>
                        </div>
                    </div>
                `;
                list.append(card);
            });
        }
    });
</script>
</body>
</html>